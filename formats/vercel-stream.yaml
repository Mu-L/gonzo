# Vercel Stream Format (Single JSON Objects per Line)
# This format handles Vercel's streaming format where each line is a JSON object
# containing labels and the log message, severity (level) and timestamp.
#
# Example log lines from vercelclisample.json generate using Vercel CLI like "vercel logs [deployment_url|deployment_id] -j" for JSON format:
# {"level":"error","message":"actual log message","messageTruncated":false,"rowId":"1758639354881","source":"edge-function","timestampInMs":1758639354881,"requestMethod":"GET","requestPath":"/api/noise","domain":"vercel-gonzo-logs-demo-4xufftd83-jon-reeves-projects.vercel.app","responseStatusCode":-1}
# Ensure this file is in ~/.config/gonzo/formats/ and use via "vercel logs [deployment_url|deployment_id] -j | gonzo --format=vercel-stream.yaml"

# Structure:
# - labels:  ALL fields (other than "level", "message" and "timestampInMs" are automatically extracted as attributes)
# - message: The actual log message
# - timestamp(timestampInMs): When the log was generated (Unix ms / epoch format)

name: vercel-stream
description: Vercel log stream format with automatic labels extraction
author: Gonzo Community
type: json  # 'json' type for JSON-structured logs

# No json.fields mapping - use the raw JSON structure
# This preserves all the original fields for direct access

mapping:
  # Extract and parse the timestamp
  timestamp:
    field: timestampInMs
    time_format: unix_ms    # Vercel uses Unix ms / epoch format

  # The 'message' field contains the actual log message
  body:
    field: message

  # Extract severity from "level"
  severity:
    field: level    # First try level
    transform: uppercase            # Normalize to uppercase
    default: INFO                   # Default to INFO if not present

  # Auto-map all unmapped fields as attributes
  auto_map_remaining: true

  # Attributes are automatically extracted from the labels object
  # All fields in labels.* will become attributes
  # You can still explicitly map specific fields if you need transforms
  attributes:
    # Example of explicit mapping with transform (optional)
    # Most fields will be auto-extracted from labels
    http_status_severity:
      field: responseStatusCode
      transform: status_to_severity
